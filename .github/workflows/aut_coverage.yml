name: coverage

on:
  push: 
  pull_request:
  workflow_dispatch:

jobs: 
  build: 
    runs-on: macos-latest

    steps: 
    - name: Checkout
      uses: actions/checkout@v4

    - name: set up python 3.11
      uses: actions/setup-python@v5
      with: 
        python-version: "3.11"

    - name: install dependencies
      run: |
        python -m pip install --upgrade pip setuptools wheel
        python -m pip install .[dev]

    - name: run coverage
      run: |
        pytest --cov-config=.coveragerc --cov=./ci_course --cov-report=xml
        cat coverage.xml
        
    - name: Upload coverage reports to Codecov
      uses: codecov/codecov/codecov-action@v5
      with: 
        token: ${{ secrets.CODECOV_TOKEN }}
        fail_ci_if_error: true
        files: coverage.xml
